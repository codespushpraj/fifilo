<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Horizontal Scroll Example</title>
  <link rel="stylesheet" href="styles.css">

  <style>
    body {
      overflow-x: hidden;
      margin: 0;
    }

    .section.home-walkthrough {
      position: relative;
      overflow: visible;
      min-height: 600vh;
    }

    .sticky-wrapper {
      position: -webkit-sticky;
      position: sticky;
      top: 0px;
      display: flex;
      overflow: hidden;
      width: 100%;
      height: 100vh;
      padding-left: 25%;
      display: flex;
      align-items: center;
    }

    .scroll-border {
      position: relative;
      width: 100%;
      z-index: 0;
    }

    .horizontal-border {
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      margin: auto;
      width: 100%;
      height: 2px;
      background-image: url("data:image/svg+xml;charset=UTF-8,<svg xmlns='http://www.w3.org/2000/svg' width='400' height='2' viewBox='0 0 400 2' fill='none'><line x1='0' y1='1' x2='400' y2='1' stroke='%2385888E' stroke-width='2' stroke-dasharray='6 6'/></svg>");
    }

    .horizontal-stroke {
      border-radius: 16px;
      border: 1px solid #f3dbeb;
      background: rgba(246, 247, 249, 0.2);
      backdrop-filter: blur(17px);
      width: 72px;
      height: 72px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: 0.6s all ease;
    }

    .horizontal-stroke.active {
      background: linear-gradient(180deg, #ffd373 -0.06%, #fdb913 100.13%);
    }

    .horizontal-stroke img {
      width: 40px;
      height: auto;
    }

    .horizontal-stroke.active img {
      filter: brightness(0) invert(0);
    }

    .horizontal-stroke-arrow {
      background-color: #fdb913;
      width: 0;
      height: 2px;
      position: absolute;
      top: 0;
      bottom: 0;
      margin: auto;
      left: 0;
      transition: width 0.5s ease;
      z-index: -1;
    }

    .horizontal-stroke-arrow .arrow-down {
      width: 18px;
      height: 25px;
      position: absolute;
      top: 0;
      bottom: 0;
      left: auto;
      right: -12px;
      margin: auto;
      z-index: -1;
    }

    .horizontal-stroke-arrow .arrow-down img {
      width: 24px;
      height: auto;
    }

    .horizontal-scroll-wrapper {
      display: -ms-grid;
      display: grid;
      width: 200vh;
      padding-top: 1.5rem;
      grid-auto-columns: 1fr;
      grid-column-gap: 3rem;
      grid-row-gap: 3rem;
      -ms-grid-columns: 1fr 1fr 1fr 1fr;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      -ms-grid-rows: auto;
      grid-template-rows: auto;
      color: #000;
    }

    .horizontal-scroll-container {
      display: -webkit-box;
      display: -webkit-flex;
      display: -ms-flexbox;
      display: flex;
      width: 100%;
      max-width: 650px;
      padding-right: 5rem;
      -webkit-box-orient: vertical;
      -webkit-box-direction: normal;
      -webkit-flex-direction: column;
      -ms-flex-direction: column;
      flex-direction: column;
      -webkit-box-pack: start;
      -webkit-justify-content: flex-start;
      -ms-flex-pack: start;
      justify-content: flex-start;
      -webkit-box-align: start;
      -webkit-align-items: flex-start;
      -ms-flex-align: start;
      align-items: flex-start;
      grid-auto-columns: 1fr;
      grid-column-gap: 146px;
      grid-row-gap: 16px;
      -ms-grid-columns: 0.75fr 0.5fr;
      grid-template-columns: 0.75fr 0.5fr;
      -ms-grid-rows: auto;
      grid-template-rows: auto;
    }

    .dark {
      background-color: #000;
      height: 100vh;
    }
  </style>
</head>

<body>
  <div className="dark"></div>
  <div className="light"></div>
  <div className="dark"></div>
  <div className="section home-walkthrough">
    <div className="sticky-wrapper">
      <div className="horizontal-scroll-wrapper">
        <div className="horizontal-scroll-container">
          <div className="scroll-border">
            <div className="horizontal-border"></div>
            <div className="horizontal-stroke">
              <img src="../img/stars-02.svg" alt="icon">
            </div>
            <div className="horizontal-stroke-arrow">
            </div>
          </div>
          <div className="text-outlined">Subheading</div>
          <h2 className="no-margin">Engaging title goes here</h2>
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
            dolore
            magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
            commodo
            consequat. </p>
        </div>
        <div className="horizontal-scroll-container">
          <div className="scroll-border">
            <div className="horizontal-border"></div>
            <div className="horizontal-stroke">
              <img src="../img/stars-02.svg" alt="icon">
            </div>
            <div className="horizontal-stroke-arrow">
            </div>
          </div>
          <div className="text-outlined">Subheading</div>
          <h2 className="no-margin">Engaging title goes here</h2>
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
            dolore
            magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
            commodo
            consequat. </p>
        </div>
        <div className="horizontal-scroll-container">
          <div className="scroll-border">
            <div className="horizontal-border"></div>
            <div className="horizontal-stroke">
              <img src="../img/stars-02.svg" alt="icon">
            </div>
            <div className="horizontal-stroke-arrow">
            </div>
          </div>
          <div className="text-outlined">Subheading</div>
          <h2 className="no-margin">Engaging title goes here<br></h2>
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
            dolore
            magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
            commodo
            consequat. </p>
        </div>
        <div className="horizontal-scroll-container">
          <div className="scroll-border">
            <div className="horizontal-border"></div>
            <div className="horizontal-stroke">
              <img src="../img/stars-02.svg" alt="icon">
            </div>
            <div className="horizontal-stroke-arrow">
            </div>
          </div>
          <div className="text-outlined">Subheading</div>
          <h2 className="no-margin">Engaging title goes here<br></h2>
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
            dolore
            magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
            commodo
            consequat. </p>
        </div>
      </div>
    </div>
  </div>
  <div className="dark"></div>

  <script>
    // document.addEventListener('DOMContentLoaded', () => {
    //   const scrollWrapper = document.querySelector('.horizontal-scroll-wrapper');
    //   const containers = document.querySelectorAll('.horizontal-scroll-container');
    //   const containerWidth = containers[0].offsetWidth; // Width of one container
    //   const totalContainers = containers.length;
    //   const maxScroll = scrollWrapper.scrollWidth - window.innerWidth; // Maximum scroll distance
    //   const bufferPercentage = 10; // Percentage from left edge to complete the width
    //   const bufferPixels = window.innerWidth * (bufferPercentage / 100);

    //   window.addEventListener('scroll', () => {
    //     const scrollPosition = window.scrollY;

    //     containers.forEach((container, index) => {
    //       const strokeArrow = container.querySelector('.horizontal-stroke-arrow');

    //       if (strokeArrow) {
    //         const containerStart = index * containerWidth;
    //         const containerEnd = (index + 1) * containerWidth;

    //         if (scrollPosition >= containerStart && scrollPosition < containerEnd) {
    //           // Calculate fill percentage for the current container with buffer
    //           const containerScroll = scrollPosition - containerStart + bufferPixels;
    //           const fillPercentage = Math.min(100, (containerScroll / containerWidth) * 100);

    //           strokeArrow.style.width = `${fillPercentage}%`;
    //         } else if (scrollPosition >= containerEnd - bufferPixels) {
    //           // Set width to 100% if scroll position is beyond the container's buffer
    //           strokeArrow.style.width = '100%';
    //         } else {
    //           // Only reset the width if the scroll position is before the start of the container
    //           if (scrollPosition < containerStart) {
    //             strokeArrow.style.width = '0%';
    //           }
    //         }
    //       }
    //     });

    //     // Apply horizontal scrolling transformation
    //     scrollWrapper.style.transform = `translate3d(-${scrollPosition}px, 0, 0)`;
    //     scrollWrapper.style.willChange = 'transform';
    //     scrollWrapper.style.transformStyle = 'preserve-3d';
    //   });
    // });

    document.addEventListener('DOMContentLoaded', () => {
      const scrollWrapper = document.querySelector('.horizontal-scroll-wrapper');
      const containers = document.querySelectorAll('.horizontal-scroll-container');
      const containerWidth = containers[0].offsetWidth; // Width of one container
      const totalWidth = containerWidth * containers.length; // Total width of all containers
      const scrollThreshold = totalWidth - window.innerWidth; // The point at which horizontal scroll should stop

      // Function to handle scrolling effect
      function handleScroll() {
        const scrollPosition = window.scrollY;

        // Ensure the horizontal scroll only occurs within the .home-walkthrough section
        const homeWalkthrough = document.querySelector('.home-walkthrough');
        const homeWalkthroughRect = homeWalkthrough.getBoundingClientRect();
        const homeWalkthroughTop = window.scrollY + homeWalkthroughRect.top;
        const homeWalkthroughBottom = homeWalkthroughTop + homeWalkthroughRect.height + scrollThreshold;

        if (scrollPosition >= homeWalkthroughTop && scrollPosition < homeWalkthroughBottom) {
          // Calculate the percentage of the section scrolled
          const scrollProgress = (scrollPosition - homeWalkthroughTop) / (homeWalkthroughBottom - homeWalkthroughTop);
          const percentageScrolled = Math.min(100, scrollProgress * 100);

          // Ensure the horizontal scroll reaches 100% before vertical scroll resumes
          const adjustedScrollProgress = Math.min(1, scrollProgress * (totalWidth / window.innerWidth));

          // Update horizontal scroll and fill effects
          scrollWrapper.style.transform = `translate3d(-${adjustedScrollProgress * 100}%, 0, 0)`;

          containers.forEach((container, index) => {
            const strokeArrow = container.querySelector('.horizontal-stroke-arrow');

            if (strokeArrow) {
              const containerStart = (index / containers.length) * 100;
              const containerEnd = ((index + 1) / containers.length) * 100;

              if (percentageScrolled >= containerStart && percentageScrolled < containerEnd) {
                const containerScroll = ((percentageScrolled - containerStart) / (containerEnd - containerStart)) * 100;
                strokeArrow.style.width = `${containerScroll}%`;
              } else if (percentageScrolled >= containerEnd) {
                strokeArrow.style.width = '100%';
              } else {
                strokeArrow.style.width = '0%';
              }
            }
          });
        }
      }

      // Create an IntersectionObserver to detect when .home-walkthrough enters and exits the viewport
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            window.addEventListener('scroll', handleScroll);
          } else {
            window.removeEventListener('scroll', handleScroll);
            // Reset horizontal scroll transform when section is out of view
            scrollWrapper.style.transform = 'translate3d(0, 0, 0)';
          }
        });
      }, {
        rootMargin: '0px', // Adjust as needed
        threshold: 0.1 // Adjust based on when you want to trigger
      });

      // Observe the .home-walkthrough section
      const homeWalkthrough = document.querySelector('.home-walkthrough');
      if (homeWalkthrough) {
        observer.observe(homeWalkthrough);
      }
    });

  </script>
</body>

</html>